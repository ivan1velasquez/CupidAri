<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Ari Cupido Adventurer</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background: #f06292; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas { 
            display: block; 
            margin: 0 auto; 
            background-color: #add8e6; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #ui {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 10;
        }
        #mensaje-victoria {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            border: 8px solid #ff85a2;
            width: 85%;
            max-width: 400px;
            z-index: 20;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 { color: #ff4d6d; margin-top: 0; }
        p { color: #555; line-height: 1.5; }
    </style>
</head>
<body>

<div id="ui">Puntos: 0 / 10</div>

<div id="mensaje-victoria">
    <h1>¡Felicidades, mi amor! ❤️</h1>
    <p>¡Ari logró llegar a tu corazón!</p>
    <p><strong>"Gracias por ser mi San Valentín. Te amo muchísimo."</strong></p>
    <button onclick="location.reload()" style="background:#ff85a2; border:none; color:white; padding:10px 20px; border-radius:10px; cursor:pointer;">Jugar de nuevo</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/** * Lógica del Videojuego para San Valentín 
 * Aprovechando tus conocimientos en desarrollo web
 */

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const marcador = document.getElementById("ui");
const winScreen = document.getElementById("mensaje-victoria");

// Adaptación de pantalla
canvas.width = window.innerWidth > 450 ? 400 : window.innerWidth;
canvas.height = window.innerHeight;

// --- RECURSOS ---
const bgImg = new Image();
bgImg.src = 'background.jpg'; // Asegúrate de que el nombre coincida

// --- CONFIGURACIÓN DEL JUEGO ---
let score = 0;
const goal = 10; // Puntos para ganar
let gameRunning = true;
let frame = 0;

const ari = {
    x: 50,
    y: canvas.height / 2,
    w: 50,
    h: 40,
    gravity: 0.4,
    lift: -7,
    velocity: 0
};

const pipes = [];
const pipeWidth = 70;
const pipeGap = 170; // Espacio entre tubos

function drawAri() {
    // Prototipo de Ari (Hitbox con color de cuy)
    ctx.fillStyle = "#d7b197"; // Color base
    ctx.beginPath();
    ctx.roundRect(ari.x, ari.y, ari.w, ari.h, 10);
    ctx.fill();
    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.stroke();

    // Alitas de Cupido
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.ellipse(ari.x, ari.y + 10, 15, 8, Math.PI / 4, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
}

function update() {
    if (!gameRunning) return;

    ari.velocity += ari.gravity;
    ari.y += ari.velocity;

    // Colisión con límites
    if (ari.y + ari.h > canvas.height || ari.y < 0) reset();

    // Generar tuberías
    if (frame % 110 === 0) {
        let minHeight = 50;
        let maxHeight = canvas.height - pipeGap - minHeight;
        let h = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
        pipes.push({ x: canvas.width, top: h, passed: false });
    }

    // Actualizar tuberías
    for (let i = pipes.length - 1; i >= 0; i--) {
        pipes[i].x -= 2.5; // Velocidad

        // Dibujar Tubería Rosada con Borde Negro
        ctx.fillStyle = "#ff85a2";
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = 4;

        // Tubo Superior
        ctx.fillRect(pipes[i].x, 0, pipeWidth, pipes[i].top);
        ctx.strokeRect(pipes[i].x, -5, pipeWidth, pipes[i].top + 5);

        // Tubo Inferior
        let bY = pipes[i].top + pipeGap;
        let bH = canvas.height - bY;
        ctx.fillRect(pipes[i].x, bY, pipeWidth, bH);
        ctx.strokeRect(pipes[i].x, bY, pipeWidth, bH + 5);

        // Detección de Colisiones
        if (ari.x < pipes[i].x + pipeWidth && ari.x + ari.w > pipes[i].x) {
            if (ari.y < pipes[i].top || ari.y + ari.h > pipes[i].top + pipeGap) {
                reset();
            }
        }

        // Puntaje
        if (!pipes[i].passed && pipes[i].x < ari.x) {
            pipes[i].passed = true;
            score++;
            marcador.innerText = `Puntos: ${score} / ${goal}`;
            if (score >= goal) win();
        }

        // Limpiar memoria
        if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
    }
}

function drawBackground() {
    if (bgImg.complete) {
        ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
    } else {
        ctx.fillStyle = "#add8e6";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
}

function reset() {
    ari.y = canvas.height / 2;
    ari.velocity = 0;
    score = 0;
    pipes.length = 0;
    marcador.innerText = `Puntos: 0 / ${goal}`;
}

function win() {
    gameRunning = false;
    winScreen.style.display = "block";
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    drawAri();
    update();
    frame++;
    if (gameRunning) requestAnimationFrame(loop);
}

// Controles
const jump = (e) => {
    if (e.type === "touchstart") e.preventDefault();
    if (gameRunning) ari.velocity = ari.lift;
};

window.addEventListener("mousedown", jump);
window.addEventListener("touchstart", jump, { passive: false });
window.addEventListener("keydown", (e) => { if(e.code === "Space") jump(e); });

loop();
</script>
</body>
</html>